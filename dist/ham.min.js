define("/common",["lodash","reqwest","exports"],function(a,b,c){"use strict";function d(a){var b=[a,1];b.push.apply(b,l.toArray(arguments).slice(1)),window.setTimeout.apply(window,b)}function e(a){var b=l.extend({},{_queue:[],send:function(a){return b.callback?void d(b.doSend,a):void b._queue.push(a)},doSend:function(a){var c=b.callback(a);return c===!1&&b.close(),c},doQueue:function(){l.each(b._queue,function(a){b.doSend(a)}),b._queue=[]},bind:function(a){b.callback=a,d(b.doQueue)},close:function(){b.closed||(b._queue=null,b.callback=null,b.closed=!0,b.onClose())},onClose:function(){}},a);return b}function f(a,b){var c=a.href;return l.each(b,function(a,b){c=c.replace("{"+b+"}",a,"g")}),c}function g(a){var b=a.href,c=b.match(n);return l.each(c,function(a){b.replace("{"+a+"}","(?P<"+a+">[wd]+)")}),new RegExp(b)}function h(a,b,c){var d=l.first(b),e=l.rest(b);e.length?(null==a[d]&&(a[d]={}),h(a[d],e,c)):a[d]=c}function i(a,b){var c=l.first(b),d=l.rest(b);if(d.length){if(null==a[c])return;i(a[c],d)}else delete a[c]}function j(a,b){var c=l.first(b),d=l.rest(b);if(d.length){if(null==a[c])return;return j(a[c],d)}return a[c]}function k(a,b,c,d,e){var f=m({url:a,method:b,data:d&&"GET"!=b&&JSON.stringify(d)||null,contentType:"application/json",headers:c,type:"json",withCredentials:!0,success:function(a){var b={headers:f.request.getAllResponseHeaders(),content:a};e(b)}})}var l=a["default"]||a,m=b["default"]||b;c.Channel=e;var n=/\{([^\{\}]*)\}/;c.urlTemplatePattern=n,c.renderUrl=f,c.renderUrlMatcher=g,c.assocIn=h,c.dissocIn=i,c.getIn=j,c.doRequest=k}),define("/ham",["lodash","/common","exports"],function(a,b,c){"use strict";function d(a){return e.extend({},m,{cacheTime:3e5,schemas:{},objects:{},recycle_bin:{},channels:{},checkSuccess:function(a){return"success"==a.status},resolveInstancesUrlFromDetailUrl:function(a){var b=null,c=null;return e.each(this.schemas,function(d){return b?!1:void e.each(d.links,function(d){var e=h(d),f=a.match(e);return f?(b=d,c={},!1):void 0})}),b?g(b,c):void 0},updateCache:function(a,b,c,d){if("GET"==b)i(this.objects,[a,b,c],d);else if("DELETE"==b){j(this.objects,[a,"GET"]);var f=this.resolveInstancesUrlFromDetailUrl(a),h=k(this.objects,[f,"GET","instances"]);if(h){var l=this.rootObject(h),m=this.getLink(h,{rel:"full",method:"GET"}),n=this.splitURIptr(l.__meta.uri);l=e.filter(l,function(b){return g(m,b)!=a}),i(h,n,l),this.publishURI(f,"GET","instances",h)}}else if("create"==c){var o=this.rootObject(d),f=this.resolveInstancesUrlFromDetailUrl(a),h=k(this.objects,[f,"GET","instances"]);if(h){var l=this.rootObject(h);l.push(o),this.publishURI(f,"GET","instances",h)}}},sendCache:function(a,b,c,d){var e=k(this.objects,[a,b,c]);if(e){d.send(e);var f=(new Date).getTime()-e.__meta.timestamp;if("GET"==b&&f<this.cacheTime)return!0}return!1},populateSchemasFromUri:function(a){var b=f(),c=this;return l(a,"GET",this.headers,null,function(a){var d=c.parseResponse(a);e.each(d,function(a,b){c.registerSchema(b,a)}),b.send(d)}),b}},a)}var e=a["default"]||a,f=b.Channel,g=b.renderUrl,h=b.renderUrlMatcher,i=b.assocIn,j=b.dissocIn,k=b.getIn,l=b.doRequest,m={regexProfileURI:/.*;.*profile\=([A-Za-z0-9\-_\/\#]+).*/,rootLink:function(a){return this.getLink(a,{rel:"root"})},splitURIptr:function(a){return e.filter(e.last(a.split("#",2)).split("/"))},subObject:function(a,b){var c=this.splitURIptr(b),d=a.__meta,e=k(a,c);return e.__meta={timestamp:d.timestamp,uri:d.uri+b},e},rootObject:function(a){var b=this.rootLink(a);if(b){var c=this.subObject(a,b.href);return c.__meta.rel="root",c}return a},getDocument:function(a,b,c,d,e){return this.streamDocument(a,b,c,d,function(a){return e(a),!1})},streamDocument:function(a,b,c,d,e){var f=this.openChannel(a,b,c,d);return f.bind(e),f},openChannel:function(a,b,c,d){var e=this.getLink(a,b),h=g(e,c),i=e.method&&e.method.toUpperCase()||"GET",j=f();return this.subscribeURI(h,i,e.rel,d,j),j},registerSchema:function(a,b){this.schemas[a]=b},getLink:function(a,b){var c=null;if("string"==typeof a){var d=this.schemas[a];d?c=d.links:console.log("failed to find schema:",a,this.schemas)}else{var d=a.__meta.schema||{};c=e.merge([],d.links,a.links)}return c=e.where(c,b),e.size(c)>1,e.first(c)},subscribeURI:function(a,b,c,d,f){var g=this,h=this.sendCache(a,b,c,f),k=e.uniqueId();h||this.callURI(a,b,c,d,f.send),i(this.channels,[a,b,c,k],f),f.onClose=function(){j(g.channels,[a,b,c,k])}},parseResponse:function(a){return a.content},callURI:function(a,b,c,d,f){var g=this;l(a,b,g.headers,d,function(d){var h=d.headers["Content-Type"]||"",i=e.last(h.match(g.regexProfileURI)),j=g.parseResponse(d);if(j.__meta={timestamp:(new Date).getTime(),uri:a},i){var k=g.schemas[i];j.__meta.schema=k,j.__meta.schema_url=i}g.publishURI(a,b,c,j),f&&f(j)})},publishURI:function(a,b,c,d){this.checkSuccess(d)&&(this.updateCache(a,b,c,d),e.each(k(this.channels,[a,b,c],function(a){a.send(d),"DELETE"==b&&a.close()})))},checkSuccess:function(){return!0},updateCache:function(){},sendCache:function(){},headers:{}};c.Ham=d}),define("ham",["/ham"],function(a){return a});